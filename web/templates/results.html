{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2>Results â€” {{ file }}</h2>

  <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
    <form method="get" action="{{ url_for('results') }}" style="display:flex;gap:8px;align-items:center;">
      <input type="hidden" name="file" value="{{ file }}">
      <label>Protocol:</label>
      <select name="proto" onchange="this.form.submit()">
        <option value="">All</option>
        {% for p in ['TCP','UDP','ICMP','DNS','HTTP','ARP','RDP'] %}
          <option value="{{ p }}" {% if proto_filter==p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </form>

    <div style="margin-left:auto">
      <a class="btn" href="{{ url_for('export_csv') }}?file={{ file }}">Export CSV</a>
      <a class="btn" href="{{ url_for('export_json') }}?file={{ file }}">Export JSON</a>
      <a class="btn" href="{{ url_for('export_pcap') }}?file={{ file }}">Download PCAP</a>
    </div>
  </div>

  <div id="alerts">
    {% if alerts %}
      <div class="alert danger"><strong>Alerts:</strong><ul>
        {% for a in alerts %}<li>{{ a }}</li>{% endfor %}
      </ul></div>
    {% endif %}
  </div>

  <table class="table table-striped table-hover">
    <thead>
      <tr><th>#</th><th>Time</th><th>Src</th><th>Dst</th><th>Proto</th><th>Len</th><th>Summary</th></tr>
    </thead>
    <tbody>
      {% for r in rows %}
        <tr style="{% if r.suspicious %}background: rgba(239,71,111,0.08);{% endif %}">
          <td>{{ r.idx }}</td>
          <td>{{ r.time }}</td>
          <td>{{ r.src }}</td>
          <td>{{ r.dst }}</td>
          <td>{{ r.proto }}</td>
          <td>{{ r.len }}</td>
          <td>{{ r.summary }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
